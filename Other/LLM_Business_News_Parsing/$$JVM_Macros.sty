
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%% LaTeX macros for Jesus Villota Miranda %%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%------------------ MARGINS -------------------%
% Language
\usepackage[english]{babel}
% Margins
\usepackage[letterpaper,
		top=3cm,
		bottom=3cm,
%		left=3.5cm,
%		right=3.5cm,
		left=2cm,
		right=2cm,
		marginparwidth=5cm
]{geometry}
%\usepackage[a4paper,top=2cm,bottom=2cm,left=2.5cm,right=2.5cm,marginparwidth=1.75cm]{geometry}

%------------------ LINE SPACING -------------------%
% Line spacing (space between lines)
\linespread{1.25}
%\linespread{1}


%------------------ FONT -------------------%
%\usepackage{newpxtext,newpxmath}	% Palatino font (text & math)



%------------------ SECTIONS -------------------%

\usepackage{titlesec}

\titleformat{\chapter} % Redefine section numbering format
  {\normalfont\LARGE\bfseries}{\thechapter.}{1em}{}

\titleformat{\section} % Redefine section numbering format
  {\normalfont\Large\bfseries}{\thesection.}{1em}{}
  
  % Define a new command for the fourth-level title.
\newcommand{\subsubsubsection}[1]{%
  \vspace{\baselineskip}% Add some space
  \noindent\textbf{#1\\}\quad% Adjust formatting as needed
}

%------------------ INDENTATION -------------------%
%\setlength{\parindent}{0pt}


%--------- READ ACCENTED LETTERS: á,é,í,ó,ú -----------%
%\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}

%------------- TABLE & FIGURE CAPTIONS ---------------%
\usepackage{booktabs,caption}
\usepackage{subcaption}
\usepackage{etoolbox} 
%\usepackage{threeparttable} % For table footnotes
\usepackage[flushleft]{threeparttable}

%Font options: {bf, it, sc}

\AtBeginEnvironment{table}{%
  \captionsetup{
  	font=small
  	, 
  	labelfont=sc
%  	,
%  	textfont=it
  	}
}
\AtBeginEnvironment{figure}{%
  \captionsetup{
  	font=small
  	,
  	labelfont=sc
%  	,
%  	textfont=it
  	}
}

%--------------- BIBLIOGRAPHY -------------------%
\usepackage{natbib}
\bibliographystyle{abbrvnat}
\setcitestyle{authoryear,open={(},close={)}} 


%------------------ APPENDIX -------------------%
\usepackage{appendix}


%------------------ PACKAGES -------------------%
\usepackage{amsmath,amssymb}
\usepackage{graphicx}
\usepackage[colorlinks=true, allcolors=blue]{hyperref}
\usepackage{datetime2}
\usepackage[inline]{enumitem}
\setlist[enumerate,2]{label=(\alph*)}	 % Changes a) to (a) in 2nd level enumeration
\usepackage{dsfont}				% for better double-trace symbols (e.g: indicator 1)
\usepackage{bm}						% for \boldsymbol
\usepackage{amssymb} 			% for the \checkmark
\usepackage{bbding}				% bold checkmark \Checkmark \CheckmarkBold
\usepackage{tikz}
\usetikzlibrary{matrix}
\usetikzlibrary{positioning}
\usepackage{float} % Allows the [H] option when including graphics
\usepackage{mathtools}			% used for subscript in front \prescript
\usepackage{eurosym} % TO PRINT EURO SYMBOL IN MATH MODE: \euro
\newtheorem{assumption}{Assumption}
\usepackage{animate}
\usepackage{pdflscape}
\usepackage{multicol}
\usepackage{lmodern}


%----------  CLEVER REFERENCE  -----------------
\usepackage{cleveref}

\crefname{figure}{Figure}{Figures}
\Crefname{figure}{Figure}{Figures}

\crefname{table}{Table}{Tables}
\Crefname{table}{Table}{Tables}

\crefname{table}{Table}{Tables}
\Crefname{table}{Table}{Tables}

\crefname{algorithm}{Algorithm}{Algorithms}
\Crefname{algorithm}{Algorithm}{Algorithms}



%-------------- TABLES ----------------%
\usepackage{longtable}
\usepackage{multirow}
\usepackage{array}
\usepackage{rotating}
\usepackage{hhline}
\usepackage{makecell}
\providecommand{\tabularnewline}{\\}
\newcolumntype{L}[1]{>{\raggedright\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}
\newcolumntype{C}[1]{>{\centering\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}
\newcolumntype{R}[1]{>{\raggedleft\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}
\usepackage{colortbl} % for coloring table cells

%-------------- ALGORITHMS ----------------%
% OPTION 1 
%\usepackage[ruled,vlined]{algorithm2e} 

% OPTION 2
\usepackage{algorithm}					
\usepackage{algpseudocode}

% Adding a dot after the Algorithm name environment "Algorithm X."
\makeatletter
\renewcommand{\thealgorithm}{\arabic{algorithm}.}
\makeatother

%-------------- CODING LISTS ----------------%
\usepackage{listings}
\usepackage{matlab-prettifier}
%\usepackage{color}
%\usepackage{xcolor}

\definecolor{lightgray}{gray}{0.99}		% A higher value implies lighter grey

%--------------- R lstlisting --------------------
\lstdefinestyle{RStyle}{
  language=R,
  basicstyle=\ttfamily\small,
  commentstyle=\color{green},
  keywordstyle=\color{blue},
  numberstyle=\tiny\color{gray},
  stringstyle=\color{purple},
  backgroundcolor=\color{lightgray},
  showspaces=false,
  showstringspaces=false,
  showtabs=false,
  rulecolor=\color{black},
  linewidth=\linewidth,
  breaklines=true,
  breakatwhitespace=true,
  breakautoindent=true,
  captionpos=b,
  numbers=left,
  numbersep=5pt,
  xleftmargin=.27in,
  xrightmargin=.05in,
  frame=single,
  framexleftmargin=15pt
}

%--------------- MATLAB lstlisting --------------------
\lstdefinestyle{matlab}{
   language=Matlab,
   style=Matlab-editor,
   basicstyle=\mlttfamily\small,
   numbers=left,
   numberstyle=\tiny,
   numbersep=5pt,
   backgroundcolor=\color{white},
   showspaces=false,
   showstringspaces=false,
   showtabs=false,
   frame=single,
   rulecolor=\color{black},
   tabsize=2,
   captionpos=b,
   breaklines=true,
   breakatwhitespace=true,
   title=\lstname,
   escapeinside={\%*}{*)},
}
%----------------------------------------------------
%--------------- CODING ENVIRONMENTS ----------------
%----------------------------------------------------


%--------------- MATLAB environment ------------------
 \lstnewenvironment{matlab}{
	\vspace{-\baselineskip}\lstset{style=Matlab-editor,language=Matlab}}{
	\vspace{\baselineskip}}
% This is how it works
%	\begin{matlab}
%			YOUR CODE HERE
%	\end{matlab}

%-------------- PYTHON environment --------------------
% Alternative 1
%\usepackage{pythonhighlight} % Not compatible w/ LiveType

% Alternative 2
\DeclareFixedFont{\ttb}{T1}{txtt}{bx}{n}{12} % for bold
\DeclareFixedFont{\ttm}{T1}{txtt}{m}{n}{12}  % for normal

% Custom colors
\usepackage{color}
\definecolor{deepblue}{rgb}{0,0,0.5}
\definecolor{deepred}{rgb}{0.6,0,0}
\definecolor{deepgreen}{rgb}{0.2,0.5,0.5}

\usepackage{listings}

% Python style for highlighting
\newcommand\pythonstyle{\lstset{
language=Python,
basicstyle=\ttm,
morekeywords={self},              % Add keywords here
keywordstyle=\ttb\color{deepblue},
emph={MyClass,__init__},          % Custom highlighting
emphstyle=\ttb\color{deepred},    % Custom highlighting style
stringstyle=\color{deepgreen},
frame=tb,                         % Any extra options here
showstringspaces=false
}}

% Python environment
\lstnewenvironment{python}[1][]
{
\pythonstyle
\lstset{#1}
}
{}

% Python for external files
\newcommand\pythonexternal[2][]{{
\pythonstyle
\lstinputlisting[#1]{#2}}}

% Python for inline
\newcommand\pythoninline[1]{{\pythonstyle\lstinline!#1!}}


%	\begin{python}
%			YOUR CODE HERE
%	\end{python}

%----------------------------------------------------
%\usepackage{verbatim} 
%\newcommand{\code}[1]{%
%    \begin{verbatim}
%    #1
%    \end{verbatim}
%}
\newcommand{\code}[1]{\texttt{#1}}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%  COMMENTED FOR THE MASTER THESIS  %%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%-------------- HEADER & FOOTER ----------------%
%\usepackage{fancyhdr}
%\pagestyle{fancy}
%\fancyhf{} % Clear the header and footer
%% Set up Header
%\fancyhead[L]{\textsc{\Subject}}
%\fancyhead[C]{\textsc{\Arg}}
%\fancyhead[R]{\textsc{Jesus Villota Miranda}}
%\renewcommand{\headrulewidth}{0.4pt}
%% Set up Footer
%\renewcommand{\footrulewidth}{0.4pt}
%\fancyfoot[L]{\DTMnow}
%\fancyfoot[C]{CEMFI}
%\fancyfoot[R]{\thepage}
%% Set up a macro to call \Subject and \PS commands
%\newcommand{\Subject}[1]{\def\Subject{#1}}			% \Subject{XXX}
%\newcommand{\Arg}[1]{\def\Arg{#1}}						% \Arg{XXX}


%--------------- PROBLEM WORDING ----------------%
\usepackage{mdframed}
\usepackage{xcolor}
\usepackage{ifthen}
\usepackage{framed}

% Define the grey shaded box environment
\newmdenv[
backgroundcolor=gray!20,							% Other cool color: LightBlue!60
linewidth=0pt,
innerleftmargin=20pt,							% Left margin
innerrightmargin=20pt,							% Right margin
innerbottommargin=10pt,							% Botton margin
innertopmargin=10pt,							% Upper margin
skipabove=\topsep,
skipbelow=\topsep,
]{shadedbox}
% Defining the q-environment
\newenvironment{q}[1][]{
  \ifthenelse{\equal{#1}{}} % Check if the argument is empty
  {
    \begin{shadedbox}
  }
  {
    \begin{shadedbox}
      \begin{center}
        \large{\textbf{#1}} 
      \end{center}%
  }
}
{
  \end{shadedbox}%
}
% \begin{q}[X] ... \end{q} includes Problem number
% \begin{q}    ... \end{q} doesn't include Problem number


% Setting up manual enumeration to avoid problems resuming enumeration
\makeatletter
\newcommand\setItemnumber[1]{\setcounter{enum\romannumeral\@enumdepth}{\numexpr#1-1\relax}}
\makeatother


%---------- HORIZONTAL LINE -------------%

\def\Vhrulefill{\leavevmode\leaders\hrule height 0.7ex depth \dimexpr1.4pt-0.7ex \hfill\kern0pt}



%----------  MACROS / COMMANDs -------------%
\newcommand{\qquote}[1]{``\textit{#1}''}
\newcommand{\sx}{\smallskip}
\newcommand{\mx}{\medskip}
\newcommand{\bx}{\bigskip}
\newcommand{\veps}{\varepsilon}
\newcommand{\eps}{\epsilon}

\renewcommand{\P}{\mathbb{P}} 						% P-measure
\newcommand{\Q}{\mathbb{Q}} 							% Q-measure
%\newcommand{\E}{\mathds{E}}      
\newcommand{\E}{\mathbb{E}}    
   % Expectations
\renewcommand{\Pr}{\mathds{P}}                      % Probabilities
\newcommand{\Var}{\operatorname{Var}}               % Variance (I) Var
%\newcommand{\V}{\mathds{V}}
\newcommand{\V}{\mathbb{V}}                         % Variance: double V
\newcommand{\Cov}{\operatorname{Cov}}               % Covariance
\newcommand{\C}{\mathbb{C}}               			% Covariance
\newcommand{\Corr}{\operatorname{Corr}}             % Correlation
\DeclareMathOperator*{\plim}{plim}					% plim
\newcommand{\st}{\operatorname{s.t.}}
\newcommand{\IF}{\operatorname{if}}
%\newcommand{\FOR}{\operatorname{for}}
\newcommand{\WP}{\operatorname{w/p}}
\renewcommand{\b}{\boldsymbol}                       % Bold Symbol
\newcommand{\mbf}{\mathbf}                          % Math Boldface
\DeclareMathOperator{\diag}{diag}					% \diag
\DeclareMathOperator{\sgn}{sgn}	
\DeclareMathOperator{\tr}{tr}
\DeclareMathOperator{\rank}{rank}
\DeclareMathOperator{\size}{size}
\DeclareMathOperator{\adj}{adj}
\DeclareMathOperator{\cof}{cof}
%\newcommand{\For}[2]{\operatorname{For}_{#1}\1{#2}}
%\newcommand{\Fut}[2]{\operatorname{Fut}_{#1}\1{#2}}
%\newcommand{\e}[3]{\mathds{E}_{#1}^{#2}\2{#3}}
\newcommand{\lp}[2]{P\1{{#1}\c\angl{#2}}}
\newcommand{\proj}[2]{P\1{{#1}\c{#2}}}
%%%% MATHCAL SHORTCUTS %%%%
\newcommand{\N}{\mathcal{N}}							% Normal distribution
\newcommand{\D}{\mathcal{D}}							% Data
\newcommand{\G}{\mathcal{G}}
\newcommand{\X}{\mathcal{X}}
\newcommand{\F}{\mathcal{F}}			
\newcommand{\U}{\mathcal{U}}
%%---- MICROECONOMETRICS EXAM SHORTCUTS ---%%
\newcommand{\Gn}{\mathbb{G}_n}
\newcommand{\Pn}{\mathbb{P}_n} 	
\newcommand{\NPV}{\mathbb{NPV}}
%\renewcommand{\d}{\text{d}}							% \d for \text{d} : DERIVATIVES
\newcommand{\R}{\mathbb{R}}							% Real numbers
\newcommand{\M}{\mathbb{M}}	
\renewcommand{\H}{\mathbb{H}}			


%%---- Parentheses ----%%
\newcommand{\1}[1]{\left(#1\right)}				% \1{ ... } -> \left( ... \right)
\newcommand{\2}[1]{\left[#1\right]}				% \2{ ... } -> \left[ ... \right]
\newcommand{\3}[1]{\left\{#1\right\}}			% \3{ ... } -> \left\{ ... \right\}
\newcommand{\4}[1]{ \big{(} #1 \big{)} }
\newcommand{\5}[1]{ \big{[} #1 \big{]} }	
\newcommand{\6}[1]{ \big{\{} #1 \big{\}} }		
\newcommand{\7}[1]{ \bigg{(} #1 \bigg{)} }
\newcommand{\8}[1]{ \bigg{[} #1 \bigg{]} }	
\newcommand{\9}[1]{ \bigg{\{} #1 \bigg{\}} }		
\newcommand{\abs}[1]{\left|#1\right|}			      
\newcommand{\norm}[1]{\lVert#1\rVert}
\newcommand{\angl}[1]{\langle #1 \rangle}
\newcommand{\flexangl}[1]{\left\langle #1 \right\rangle}

\newcommand{\integer}[1]{\lfloor #1 \rfloor}

%%%%%% MY OWN MACRO FOR CASES
\newcommand{\mycases}[2]{%
    \left\{
    \begin{array}{#1}
    #2
    \end{array}
    \right.
}
\newcommand{\ub}[2]{\underbrace{#1}_{#2}}			% underbrace commmand
\newcommand{\I}[1]{\mathds{1}_{\{#1\}}}				% Indicator (\I)
\renewcommand{\l}[1]{\boldsymbol{\ell}_{#1}}			% vector of 1's (\l)
\renewcommand{\'}{^\top}	
\renewcommand{\c}{\;\middle|\;}						% adjustable vertical bar
\renewcommand{\t}[1]{\text{#1}}

% PARTIAL DERIVATIVES MACRO: \p{A}{B} = \frac{\partial A}{\partial B}
\newcommand{\p}[2]{\frac{\partial #1}{\partial #2}}
% SIMPLE DERIVATIVES MACRO: \d{A}{B} = \frac{d A}{d B}
\renewcommand{\d}[2]{\frac{d #1}{d #2}} 

%%%% COMMAND FOR PUTTING SUBSCRIPT IN FRONT %%%%%
\newcommand{\pr}[2]{\prescript{}{#1}{#2}}

% DEFINING VECTORS IN A SIMPLE WAY
\renewcommand{\v}[1]{%
  \begin{matrix}
    #1
  \end{matrix}%
}
\newcommand{\cd}{\cdot}		% \cd = SHORTCUT FOR · (\cdot)

\newcommand\indep{\protect\mathpalette{\protect\independenT}{\perp}}
\def\independenT#1#2{\mathrel{\rlap{$#1#2$}\mkern2mu{#1#2}}}

%------------------  COLORS -------------------%
% Define custom color macro that changes text and math content to the color
% RED
\newcommand{\red}[1]{%
  \ifmmode
    \textcolor{red}{#1}%
  \else
    {\color{red}#1}%
  \fi
}
% GREEN
\definecolor{dark_green}{rgb}{0.05, 0.5, 0.06}
\newcommand{\green}[1]{%
  \ifmmode
    \textcolor{dark_green}{#1}%
  \else
    {\color{dark_green}#1}%
  \fi
}
% GREY
\definecolor{Grey_color}{RGB}{144,144,144}
\newcommand{\grey}[1]{%
  \ifmmode
    \textcolor{Grey_color}{#1}%
  \else
    {\color{Grey_color}#1}%
  \fi
}
% GREY
\definecolor{Dark_Grey_color}{RGB}{100,100,100}
\newcommand{\darkgrey}[1]{%
  \ifmmode
    \textcolor{Dark_Grey_color}{#1}%
  \else
    {\color{Dark_Grey_color}#1}%
  \fi
}
% BLUE
\newcommand{\blue}[1]{%
  \ifmmode
    \textcolor{blue}{#1}%
  \else
    {\color{blue}#1}%
  \fi
}
\newcommand{\cyan}[1]{%
  \ifmmode
    \textcolor{cyan}{#1}%
  \else
    {\color{cyan}#1}%
  \fi
}
% BLUE
\newcommand{\brown}[1]{%
  \ifmmode
    \textcolor{brown}{#1}%
  \else
    {\color{brown}#1}%
  \fi
}
% VIOLET
\newcommand{\violet}[1]{%
  \ifmmode
    \textcolor{violet}{#1}%
  \else
    {\color{violet}#1}%
  \fi
}
% BLUE
\definecolor{dark_blue}{rgb}{0, 0.2, 0.7}
\newcommand{\bblue}[1]{%
  \ifmmode
    \textcolor{dark_blue}{#1}%
  \else
    {\color{dark_blue}#1}%
  \fi
}

%%%%%%%%%%%% BOXED ENVIRONMENTS FOR EQUATIONS %%%%%%%%%%
% default is red
% [teal] [olive] [violet]
% example: \resubp[violet]{}


\newsavebox\MBox
\newcommand{\resub}[2][red]{\,{%
		\sbox\MBox{$\,#2$}%
		\rlap{\begin{tikzpicture}[baseline=(X.base)]
				\node[inner sep=0pt,outer sep=0pt] (X) {\usebox\MBox};
				\fill[#1!35, nearly transparent] ([yshift=-2.5pt]X.south west) rectangle ([yshift=2.5pt]X.north east);
				\draw[-,#1, line width=1pt] ([yshift=-3pt]X.south west) -- ([yshift=5pt]X.south west);
				\draw[-,#1, line width=1pt] ([yshift=3pt]X.north west) -- ([yshift=-5pt]X.north west);
				\draw[-,#1, line width=1pt] ([yshift=-3pt]X.south east) -- ([yshift=5pt]X.south east);
				\draw[-,#1, line width=1pt] ([yshift=3pt]X.north east) -- ([yshift=-5pt]X.north east);
				\draw[-,#1, line width=1pt] ([yshift=-2.5pt]X.south west) -- ([xshift=7.5pt,yshift=-2.5pt]X.south west);
				\draw[-,#1, line width=1pt] ([yshift=2.5pt]X.north west) -- ([xshift=7.5pt,yshift=2.5pt]X.north west);
				\draw[-,#1, line width=1pt] ([yshift=-2.5pt]X.south east) -- ([xshift=-7.5pt,yshift=-2.5pt]X.south east);
				\draw[-,#1, line width=1pt] ([yshift=2.5pt]X.north east) -- ([xshift=-7.5pt,yshift=2.5pt]X.north east);
		\end{tikzpicture}}%
		\phantom{\usebox\MBox\,}
}}


\newcommand{\resubp}[2][red]{\,{%
		\sbox\MBox{$\,#2$}%
		\rlap{\begin{tikzpicture}[baseline=(X.base)]
				\node[inner sep=0pt,outer sep=0pt] (X) {\usebox\MBox};
				\fill[#1!35, nearly transparent] ([yshift=-2.5pt]X.south west) rectangle ([yshift=2.5pt]X.north east);
				\draw[-,#1, line width=1pt] ([yshift=-3pt]X.south west) -- ([yshift=1pt]X.south west);
				\draw[-,#1, line width=1pt] ([yshift=3pt]X.north west) -- ([yshift=-1pt]X.north west);
				\draw[-,#1, line width=1pt] ([yshift=-3pt]X.south east) -- ([yshift=1pt]X.south east);
				\draw[-,#1, line width=1pt] ([yshift=3pt]X.north east) -- ([yshift=-1pt]X.north east);
				\draw[-,#1, line width=1pt] ([yshift=-2.5pt]X.south west) -- ([xshift=3.5pt,yshift=-2.5pt]X.south west);
				\draw[-,#1, line width=1pt] ([yshift=2.5pt]X.north west) -- ([xshift=3.5pt,yshift=2.5pt]X.north west);
				\draw[-,#1, line width=1pt] ([yshift=-2.5pt]X.south east) -- ([xshift=-3.5pt,yshift=-2.5pt]X.south east);
				\draw[-,#1, line width=1pt] ([yshift=2.5pt]X.north east) -- ([xshift=-3.5pt,yshift=2.5pt]X.north east);
		\end{tikzpicture}}%
		\phantom{\usebox\MBox\,}
}}


\usepackage{pifont}  % For the \ding command
\definecolor{verde}{RGB}{0,140,80}
\definecolor{rojo}{RGB}{160,0,0}
\definecolor{azul}{RGB}{0,80,140}
\newcommand{\cmark}{{\color{verde}{\ding{51}}}}%
\newcommand{\xmark}{{\color{rojo}{\ding{55}}}}%
\newcommand{\imark}{{\color{azul}{\ding{66}}}}%

\definecolor{darkgreen}{rgb}{0.0, 0.3, 0.0}
\definecolor{darkred}{rgb}{0.55, 0.0, 0.0}


\usepackage{varwidth}
\newcommand{\mybox}[1]{%
  \par\noindent\fbox{%
    \begin{varwidth}{\linewidth}#1\end{varwidth}%
  }\par
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% END OF MACROS %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
